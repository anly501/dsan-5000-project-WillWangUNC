<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Decision tree</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./aboutyou.html" rel="" target="">
 <span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./code.html" rel="" target="">
 <span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./introduction.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./datagather.html" rel="" target="">
 <span class="menu-text">Data Gathering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dataclean.html" rel="" target="">
 <span class="menu-text">Data Cleaning</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dataexplore.html" rel="" target="">
 <span class="menu-text">Data Exploration</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./naive.html" rel="" target="">
 <span class="menu-text">Naïve Bayes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./clustering.html" rel="" target="">
 <span class="menu-text">Clustering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dimreduction.html" rel="" target="">
 <span class="menu-text">Dimensionality reduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./decisiontree.html" rel="" target="" aria-current="page">
 <span class="menu-text">Decision Trees</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./conclusions.html" rel="" target="">
 <span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#brief-introduction-of-decision-tree" id="toc-brief-introduction-of-decision-tree" class="nav-link active" data-scroll-target="#brief-introduction-of-decision-tree">Brief introduction of Decision tree</a>
  <ul class="collapse">
  <li><a href="#binary-classification-with-decision-trees" id="toc-binary-classification-with-decision-trees" class="nav-link" data-scroll-target="#binary-classification-with-decision-trees">Binary classification with decision trees</a></li>
  <li><a href="#we-will-be-using-ytarget-output-target-and-all-other-remaining-columns-as-our-x-input-feature-matrix-for-binary-classification." id="toc-we-will-be-using-ytarget-output-target-and-all-other-remaining-columns-as-our-x-input-feature-matrix-for-binary-classification." class="nav-link" data-scroll-target="#we-will-be-using-ytarget-output-target-and-all-other-remaining-columns-as-our-x-input-feature-matrix-for-binary-classification.">We will be using y=“target” (output target) and all other remaining columns as our X (input feature) matrix for binary classification.</a></li>
  <li><a href="#show-the-heat-map-for-the-correlation-matrix" id="toc-show-the-heat-map-for-the-correlation-matrix" class="nav-link" data-scroll-target="#show-the-heat-map-for-the-correlation-matrix">Show the heat-map for the correlation matrix</a></li>
  <li><a href="#generate-a-seaborn-pairplot-to-check-any-patterns" id="toc-generate-a-seaborn-pairplot-to-check-any-patterns" class="nav-link" data-scroll-target="#generate-a-seaborn-pairplot-to-check-any-patterns">Generate a Seaborn pairplot to check any patterns</a></li>
  <li><a href="#partition-the-dataset-into-training-and-test-sets-and-train-a-sklearn-decision-tree-model" id="toc-partition-the-dataset-into-training-and-test-sets-and-train-a-sklearn-decision-tree-model" class="nav-link" data-scroll-target="#partition-the-dataset-into-training-and-test-sets-and-train-a-sklearn-decision-tree-model">Partition the dataset into training and test sets and train a Sklearn decision tree model</a></li>
  <li><a href="#now-fit-the-trained-model-both-on-the-training-and-testing-sets" id="toc-now-fit-the-trained-model-both-on-the-training-and-testing-sets" class="nav-link" data-scroll-target="#now-fit-the-trained-model-both-on-the-training-and-testing-sets">Now fit the trained model both on the training and testing sets</a></li>
  <li><a href="#the-provided-confusion-matrix-suggests-that-the-trained-decision-tree-model-excels-in-accurately-predicting-negative-cases-demonstrating-a-high-level-of-proficiency-in-identifying-instances-where-the-outcome-is-not-of-significant-concern.-however-the-model-appears-to-struggle-when-it-comes-to-predicting-positive-cases-particularly-those-that-are-critically-serious-indicating-a-limitation-in-its-ability-to-capture-instances-with-higher-importance-or-severity." id="toc-the-provided-confusion-matrix-suggests-that-the-trained-decision-tree-model-excels-in-accurately-predicting-negative-cases-demonstrating-a-high-level-of-proficiency-in-identifying-instances-where-the-outcome-is-not-of-significant-concern.-however-the-model-appears-to-struggle-when-it-comes-to-predicting-positive-cases-particularly-those-that-are-critically-serious-indicating-a-limitation-in-its-ability-to-capture-instances-with-higher-importance-or-severity." class="nav-link" data-scroll-target="#the-provided-confusion-matrix-suggests-that-the-trained-decision-tree-model-excels-in-accurately-predicting-negative-cases-demonstrating-a-high-level-of-proficiency-in-identifying-instances-where-the-outcome-is-not-of-significant-concern.-however-the-model-appears-to-struggle-when-it-comes-to-predicting-positive-cases-particularly-those-that-are-critically-serious-indicating-a-limitation-in-its-ability-to-capture-instances-with-higher-importance-or-severity.">The provided confusion matrix suggests that the trained decision tree model excels in accurately predicting negative cases, demonstrating a high level of proficiency in identifying instances where the outcome is not of significant concern. However, the model appears to struggle when it comes to predicting positive cases, particularly those that are critically serious, indicating a limitation in its ability to capture instances with higher importance or severity.</a></li>
  <li><a href="#now-loop-over-some-possible-hyper-parameter-values-to-find-the-best-maximum-depth-for-the-decision-tree-model" id="toc-now-loop-over-some-possible-hyper-parameter-values-to-find-the-best-maximum-depth-for-the-decision-tree-model" class="nav-link" data-scroll-target="#now-loop-over-some-possible-hyper-parameter-values-to-find-the-best-maximum-depth-for-the-decision-tree-model">Now loop over some possible hyper-parameter values to find the best maximum depth for the decision tree model</a></li>
  <li><a href="#from-the-above-plots-we-can-tell-the-best-number-of-layers-in-the-decision-tree-might-be-17-since-the-model-is-performing-well-at-correctly-identifying-instances-of-the-negative-class-true-negatives-but-is-not-as-effective-at-capturing-instances-of-the-positive-class-true-positives.we-should-select-a-value-for-max_depth-that-is-as-large-as-possible." id="toc-from-the-above-plots-we-can-tell-the-best-number-of-layers-in-the-decision-tree-might-be-17-since-the-model-is-performing-well-at-correctly-identifying-instances-of-the-negative-class-true-negatives-but-is-not-as-effective-at-capturing-instances-of-the-positive-class-true-positives.we-should-select-a-value-for-max_depth-that-is-as-large-as-possible." class="nav-link" data-scroll-target="#from-the-above-plots-we-can-tell-the-best-number-of-layers-in-the-decision-tree-might-be-17-since-the-model-is-performing-well-at-correctly-identifying-instances-of-the-negative-class-true-negatives-but-is-not-as-effective-at-capturing-instances-of-the-positive-class-true-positives.we-should-select-a-value-for-max_depth-that-is-as-large-as-possible.">From the above plots, we can tell the best number of layers in the decision tree might be 17, since the model is performing well at correctly identifying instances of the negative class (True Negatives) but is not as effective at capturing instances of the positive class (True Positives).We should select a value for ‘max_depth’ that is as large as possible.</a></li>
  <li><a href="#now-lets-visualize-the-decision-tree.-however-since-the-number-of-layers-is-somewhat-big-and-the-number-of-features-is-large-the-visualization-might-not-be-informative." id="toc-now-lets-visualize-the-decision-tree.-however-since-the-number-of-layers-is-somewhat-big-and-the-number-of-features-is-large-the-visualization-might-not-be-informative." class="nav-link" data-scroll-target="#now-lets-visualize-the-decision-tree.-however-since-the-number-of-layers-is-somewhat-big-and-the-number-of-features-is-large-the-visualization-might-not-be-informative.">Now let’s visualize the decision tree. However, since the number of layers is somewhat big and the number of features is large, the visualization might not be informative.</a></li>
  </ul></li>
  <li><a href="#in-summary" id="toc-in-summary" class="nav-link" data-scroll-target="#in-summary">In summary:</a></li>
  <li><a href="#use-random-forest-classifier" id="toc-use-random-forest-classifier" class="nav-link" data-scroll-target="#use-random-forest-classifier">Use Random Forest Classifier</a>
  <ul class="collapse">
  <li><a href="#we-will-employ-the-identical-training-and-testing-sets-as-utilized-in-the-preceding-decision-tree-section-for-training-the-random-forest-classifier." id="toc-we-will-employ-the-identical-training-and-testing-sets-as-utilized-in-the-preceding-decision-tree-section-for-training-the-random-forest-classifier." class="nav-link" data-scroll-target="#we-will-employ-the-identical-training-and-testing-sets-as-utilized-in-the-preceding-decision-tree-section-for-training-the-random-forest-classifier.">We will employ the identical training and testing sets as utilized in the preceding decision tree section for training the random forest classifier.</a></li>
  <li><a href="#check-accuracy-score-for-the-model" id="toc-check-accuracy-score-for-the-model" class="nav-link" data-scroll-target="#check-accuracy-score-for-the-model">Check accuracy score for the model</a></li>
  <li><a href="#now-lets-pick-a-random-forest-classifier-with-parameter-n_estimators-equal-to-50-and-compute-the-feature-scores" id="toc-now-lets-pick-a-random-forest-classifier-with-parameter-n_estimators-equal-to-50-and-compute-the-feature-scores" class="nav-link" data-scroll-target="#now-lets-pick-a-random-forest-classifier-with-parameter-n_estimators-equal-to-50-and-compute-the-feature-scores">Now let’s pick a random forest classifier with parameter ‘n_estimators’ equal to 50 and compute the feature scores</a></li>
  </ul></li>
  <li><a href="#lets-visualize-the-feature-scores" id="toc-lets-visualize-the-feature-scores" class="nav-link" data-scroll-target="#lets-visualize-the-feature-scores">Let’s visualize the feature scores</a></li>
  <li><a href="#in-summary-1" id="toc-in-summary-1" class="nav-link" data-scroll-target="#in-summary-1">In summary:</a>
  <ul class="collapse">
  <li><a href="#finally-lets-look-at-the-confusion-matrix-and-the-classification-report" id="toc-finally-lets-look-at-the-confusion-matrix-and-the-classification-report" class="nav-link" data-scroll-target="#finally-lets-look-at-the-confusion-matrix-and-the-classification-report">Finally, let’s look at the confusion matrix and the classification report</a></li>
  </ul></li>
  <li><a href="#in-conclusion" id="toc-in-conclusion" class="nav-link" data-scroll-target="#in-conclusion">In conclusion:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Decision tree</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="brief-introduction-of-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="brief-introduction-of-decision-tree">Brief introduction of Decision tree</h2>
<p>A decision tree is a powerful and popular machine learning algorithm used for both classification and regression tasks. It is a predictive modeling tool that maps observations about an item to conclusions about the item’s target value. The decision tree structure resembles an inverted tree, where each node represents a decision or test on an attribute, each branch represents an outcome of the test, and each leaf node represents a class label or a numerical value.</p>
<section id="binary-classification-with-decision-trees" class="level3">
<h3 class="anchored" data-anchor-id="binary-classification-with-decision-trees">Binary classification with decision trees</h3>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_score</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> recall_score</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="we-will-be-using-ytarget-output-target-and-all-other-remaining-columns-as-our-x-input-feature-matrix-for-binary-classification." class="level3">
<h3 class="anchored" data-anchor-id="we-will-be-using-ytarget-output-target-and-all-other-remaining-columns-as-our-x-input-feature-matrix-for-binary-classification.">We will be using y=“target” (output target) and all other remaining columns as our X (input feature) matrix for binary classification.</h3>
<p>Below is the processing of the data.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'./Data/RoadAccident.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>column_datatypes <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> data.columns:</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    column_datatypes.add(<span class="bu">str</span>(data[column].dtype))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The dataset contains </span><span class="sc">{}</span><span class="st"> different data types and they are: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="bu">len</span>(column_datatypes), <span class="st">", "</span>.join(column_datatypes)))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data.drop(columns<span class="op">=</span><span class="st">'Accident_Severity'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>numerical_features <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> X.columns:</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data[column].dtype <span class="op">==</span> <span class="st">'float64'</span> <span class="kw">or</span> data[column].dtype <span class="op">==</span> <span class="st">'int64'</span>):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        numerical_features.append(column)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (data[column].dtype <span class="op">==</span> <span class="st">'object'</span>):</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        categorical_features.append(column)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">'Accident_Severity'</span>]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.drop(columns<span class="op">=</span>[<span class="st">'Accident_Index'</span>,<span class="st">'Datetime'</span>])</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>discrete_features <span class="op">=</span> [<span class="st">'Driver_IMD_Decile'</span>,<span class="st">'Speed_limit'</span>,<span class="st">'Year'</span>,<span class="st">'Season'</span>,<span class="st">'Month_of_Year'</span>,<span class="st">'Day_of_Month'</span>,<span class="st">'Day_of_Week'</span>,<span class="st">'Number_of_Vehicles'</span>,<span class="st">'Age_of_Driver'</span>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> discrete_features:</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    numerical_features.remove(item)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    categorical_features.append(item)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>numerical_features.remove(<span class="st">'Accident_Index'</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>categorical_features.remove(<span class="st">'Datetime'</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>categorical_features_index <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> categorical_features:</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    categorical_features_index.append(X.columns.get_loc(i))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    X[i] <span class="op">=</span> LabelEncoder().fit_transform(X[i])</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The dataset contains 3 different data types and they are: float64, int64, object</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Urban_or_Rural_Area</th>
<th data-quarto-table-cell-role="th">X1st_Road_Class</th>
<th data-quarto-table-cell-role="th">Driver_IMD_Decile</th>
<th data-quarto-table-cell-role="th">Speed_limit</th>
<th data-quarto-table-cell-role="th">Road_Type</th>
<th data-quarto-table-cell-role="th">Road_Surface_Conditions</th>
<th data-quarto-table-cell-role="th">Weather</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Age_of_Vehicle</th>
<th data-quarto-table-cell-role="th">Junction_Detail</th>
<th data-quarto-table-cell-role="th">Junction_Location</th>
<th data-quarto-table-cell-role="th">X1st_Point_of_Impact</th>
<th data-quarto-table-cell-role="th">Driver_Journey_Purpose</th>
<th data-quarto-table-cell-role="th">Engine_CC</th>
<th data-quarto-table-cell-role="th">Propulsion_Code</th>
<th data-quarto-table-cell-role="th">Vehicle_Make</th>
<th data-quarto-table-cell-role="th">Vehicle_Category</th>
<th data-quarto-table-cell-role="th">Vehicle_Manoeuvre</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>51.495653</td>
<td>-0.179097</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>6</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>8</td>
<td>2</td>
<td>8</td>
<td>2</td>
<td>2</td>
<td>1781</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>51.499635</td>
<td>-0.209915</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>2</td>
<td>1</td>
<td>7</td>
<td>4</td>
<td>2</td>
<td>2987</td>
<td>0</td>
<td>10</td>
<td>1</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>51.492515</td>
<td>-0.168130</td>
<td>2</td>
<td>1</td>
<td>5</td>
<td>4</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>11</td>
<td>0</td>
<td>7</td>
<td>2</td>
<td>1</td>
<td>998</td>
<td>1</td>
<td>12</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>51.504784</td>
<td>-0.193863</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>5</td>
<td>7</td>
<td>7</td>
<td>4</td>
<td>1</td>
<td>2179</td>
<td>0</td>
<td>2</td>
<td>5</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>51.522072</td>
<td>-0.212927</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>4</td>
<td>7</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>2198</td>
<td>0</td>
<td>4</td>
<td>5</td>
<td>3</td>
</tr>
</tbody>
</table>

<p>5 rows × 30 columns</p>
</div>
</div>
</div>
</section>
<section id="show-the-heat-map-for-the-correlation-matrix" class="level3">
<h3 class="anchored" data-anchor-id="show-the-heat-map-for-the-correlation-matrix">Show the heat-map for the correlation matrix</h3>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> X.corr()<span class="op">;</span>  <span class="co">#print(corr)                  #COMPUTE CORRELATION OF FEATER MATRIX</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(corr.shape)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))  <span class="co"># Set up the matplotlib figure</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> sns.diverging_palette(<span class="dv">230</span>, <span class="dv">20</span>, as_cmap<span class="op">=</span><span class="va">True</span>)     <span class="co"># Generate a custom diverging colormap</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the heatmap with the mask and correct aspect ratio</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr,  cmap<span class="op">=</span>cmap, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="fl">.5</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">.5</span>})</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(30, 30)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-4-output-2.png" width="1555" height="1394"></p>
</div>
</div>
</section>
<section id="generate-a-seaborn-pairplot-to-check-any-patterns" class="level3">
<h3 class="anchored" data-anchor-id="generate-a-seaborn-pairplot-to-check-any-patterns">Generate a Seaborn pairplot to check any patterns</h3>
</section>
<section id="partition-the-dataset-into-training-and-test-sets-and-train-a-sklearn-decision-tree-model" class="level3">
<h3 class="anchored" data-anchor-id="partition-the-dataset-into-training-and-test-sets-and-train-a-sklearn-decision-tree-model">Partition the dataset into training and test sets and train a Sklearn decision tree model</h3>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>x_train, x_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> tree.DecisionTreeClassifier()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> model.fit(x_train,y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="now-fit-the-trained-model-both-on-the-training-and-testing-sets" class="level3">
<h3 class="anchored" data-anchor-id="now-fit-the-trained-model-both-on-the-training-and-testing-sets">Now fit the trained model both on the training and testing sets</h3>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>yp_train <span class="op">=</span> model.predict(x_train)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>yp_test <span class="op">=</span> model.predict(x_test)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> confusion_plot(y_data, y_pred):</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> metrics.accuracy_score(y_data, y_pred)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'ACCURACY:'</span>, accuracy)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    pre0 <span class="op">=</span> metrics.precision_score(y_data, y_pred, pos_label<span class="op">=</span><span class="st">'Slight'</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    per0 <span class="op">=</span> metrics.recall_score(y_data, y_pred, pos_label<span class="op">=</span><span class="st">'Slight'</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'NEGATIVE RECALL (Y=0):'</span>, per0)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'NEGATIVE PRECISION (Y=0):'</span>, pre0)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    pre1 <span class="op">=</span> metrics.precision_score(y_data, y_pred, pos_label<span class="op">=</span><span class="st">'Fatal_Serious'</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    per1 <span class="op">=</span> metrics.recall_score(y_data, y_pred, pos_label<span class="op">=</span><span class="st">'Fatal_Serious'</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'POSITIVE RECALL (Y=1):'</span>, per1)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'POSITIVE PRECISION (Y=1):'</span>, pre1)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    matrix <span class="op">=</span> metrics.confusion_matrix(y_data, y_pred, labels<span class="op">=</span>[<span class="st">'Slight'</span>, <span class="st">'Fatal_Serious'</span>])</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(matrix)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, xticklabels<span class="op">=</span>[<span class="st">'Slight'</span>, <span class="st">'Fatal_Serious'</span>], yticklabels<span class="op">=</span>[<span class="st">'Slight'</span>, <span class="st">'Fatal_Serious'</span>])</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Predicted label'</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'True label'</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>confusion_plot(y_train,yp_train)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>confusion_plot(y_test,yp_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ACCURACY: 1.0
NEGATIVE RECALL (Y=0): 1.0
NEGATIVE PRECISION (Y=0): 1.0
POSITIVE RECALL (Y=1): 1.0
POSITIVE PRECISION (Y=1): 1.0
[[45409     0]
 [    0 15031]]
ACCURACY: 0.6616810059563203
NEGATIVE RECALL (Y=0): 0.7669971671388102
NEGATIVE PRECISION (Y=0): 0.7774587221823402
POSITIVE RECALL (Y=1): 0.34976402726796013
POSITIVE PRECISION (Y=1): 0.3363590519415028
[[8664 2632]
 [2480 1334]]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-6-output-2.png" width="647" height="509"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-6-output-3.png" width="639" height="509"></p>
</div>
</div>
</section>
<section id="the-provided-confusion-matrix-suggests-that-the-trained-decision-tree-model-excels-in-accurately-predicting-negative-cases-demonstrating-a-high-level-of-proficiency-in-identifying-instances-where-the-outcome-is-not-of-significant-concern.-however-the-model-appears-to-struggle-when-it-comes-to-predicting-positive-cases-particularly-those-that-are-critically-serious-indicating-a-limitation-in-its-ability-to-capture-instances-with-higher-importance-or-severity." class="level3">
<h3 class="anchored" data-anchor-id="the-provided-confusion-matrix-suggests-that-the-trained-decision-tree-model-excels-in-accurately-predicting-negative-cases-demonstrating-a-high-level-of-proficiency-in-identifying-instances-where-the-outcome-is-not-of-significant-concern.-however-the-model-appears-to-struggle-when-it-comes-to-predicting-positive-cases-particularly-those-that-are-critically-serious-indicating-a-limitation-in-its-ability-to-capture-instances-with-higher-importance-or-severity.">The provided confusion matrix suggests that the trained decision tree model excels in accurately predicting negative cases, demonstrating a high level of proficiency in identifying instances where the outcome is not of significant concern. However, the model appears to struggle when it comes to predicting positive cases, particularly those that are critically serious, indicating a limitation in its ability to capture instances with higher importance or severity.</h3>
</section>
<section id="now-loop-over-some-possible-hyper-parameter-values-to-find-the-best-maximum-depth-for-the-decision-tree-model" class="level3">
<h3 class="anchored" data-anchor-id="now-loop-over-some-possible-hyper-parameter-values-to-find-the-best-maximum-depth-for-the-decision-tree-model">Now loop over some possible hyper-parameter values to find the best maximum depth for the decision tree model</h3>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>test_results<span class="op">=</span>[]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>train_results<span class="op">=</span>[]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> num_layer <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">20</span>):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> tree.DecisionTreeClassifier(max_depth<span class="op">=</span>num_layer)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model.fit(x_train, y_train)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    yp_train<span class="op">=</span>model.predict(x_train)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    yp_test<span class="op">=</span>model.predict(x_test)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    test_results.append([num_layer,accuracy_score(y_test, yp_test),recall_score(y_test, yp_test,pos_label<span class="op">=</span><span class="st">'Slight'</span>),recall_score(y_test, yp_test,pos_label<span class="op">=</span><span class="st">'Fatal_Serious'</span>)])</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    train_results.append([num_layer,accuracy_score(y_train, yp_train),recall_score(y_train, yp_train,pos_label<span class="op">=</span><span class="st">'Slight'</span>),recall_score(y_train, yp_train,pos_label<span class="op">=</span><span class="st">'Fatal_Serious'</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">'num_layer'</span>, <span class="st">'accuracy_score'</span>, <span class="st">'recall_score_0'</span>,<span class="st">'recall_score_1'</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame(train_results, columns<span class="op">=</span>columns)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'set'</span>] <span class="op">=</span> <span class="st">'Training'</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame(test_results, columns<span class="op">=</span>columns)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'set'</span>] <span class="op">=</span> <span class="st">'Test'</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>final <span class="op">=</span> pd.concat([df1, df2], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>plot1 <span class="op">=</span> sns.lineplot(x<span class="op">=</span>final[<span class="st">'num_layer'</span>], y<span class="op">=</span>final[<span class="st">'accuracy_score'</span>], hue <span class="op">=</span> final[<span class="st">'set'</span>], palette<span class="op">=</span>[<span class="st">'blue'</span>, <span class="st">'red'</span>],marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>plot1.<span class="bu">set</span>(xlabel <span class="op">=</span> <span class="st">'Number of layers in decision tree (max_depth)'</span>, ylabel <span class="op">=</span> <span class="st">'ACCURACY (Y=0): Training (blue) and Test (red)'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>plot2 <span class="op">=</span> sns.lineplot(x<span class="op">=</span>final[<span class="st">'num_layer'</span>], y<span class="op">=</span>final[<span class="st">'recall_score_0'</span>], hue <span class="op">=</span> final[<span class="st">'set'</span>], palette<span class="op">=</span>[<span class="st">'blue'</span>, <span class="st">'red'</span>],marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>plot2.<span class="bu">set</span>(xlabel <span class="op">=</span> <span class="st">'Number of layers in decision tree (max_depth)'</span>, ylabel <span class="op">=</span> <span class="st">'RECALL (Y=0): Training (blue) and Test (red)'</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>plot3 <span class="op">=</span> sns.lineplot(x<span class="op">=</span>final[<span class="st">'num_layer'</span>], y<span class="op">=</span>final[<span class="st">'recall_score_1'</span>], hue <span class="op">=</span> final[<span class="st">'set'</span>], palette<span class="op">=</span>[<span class="st">'blue'</span>, <span class="st">'red'</span>],marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>plot3.<span class="bu">set</span>(xlabel <span class="op">=</span> <span class="st">'Number of layers in decision tree (max_depth)'</span>, ylabel <span class="op">=</span> <span class="st">'RECALL (Y=1): Training (blue) and Test (red)'</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-8-output-1.png" width="601" height="435"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-8-output-2.png" width="609" height="435"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-8-output-3.png" width="593" height="437"></p>
</div>
</div>
</section>
<section id="from-the-above-plots-we-can-tell-the-best-number-of-layers-in-the-decision-tree-might-be-17-since-the-model-is-performing-well-at-correctly-identifying-instances-of-the-negative-class-true-negatives-but-is-not-as-effective-at-capturing-instances-of-the-positive-class-true-positives.we-should-select-a-value-for-max_depth-that-is-as-large-as-possible." class="level3">
<h3 class="anchored" data-anchor-id="from-the-above-plots-we-can-tell-the-best-number-of-layers-in-the-decision-tree-might-be-17-since-the-model-is-performing-well-at-correctly-identifying-instances-of-the-negative-class-true-negatives-but-is-not-as-effective-at-capturing-instances-of-the-positive-class-true-positives.we-should-select-a-value-for-max_depth-that-is-as-large-as-possible.">From the above plots, we can tell the best number of layers in the decision tree might be 17, since the model is performing well at correctly identifying instances of the negative class (True Negatives) but is not as effective at capturing instances of the positive class (True Positives).We should select a value for ‘max_depth’ that is as large as possible.</h3>
<p>Let’s check the confusion matrix again.</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> tree.DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">17</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> model.fit(x_train,y_train)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>yp_train<span class="op">=</span>model.predict(x_train)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>yp_test<span class="op">=</span>model.predict(x_test)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------TRAINING------"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>confusion_plot(y_train,yp_train)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"------TEST------"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>confusion_plot(y_test,yp_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>------TRAINING------
ACCURACY: 0.8978160158835209
NEGATIVE RECALL (Y=0): 0.970754696205598
NEGATIVE PRECISION (Y=0): 0.9009176561957122
POSITIVE RECALL (Y=1): 0.6774665690905463
POSITIVE PRECISION (Y=1): 0.8846320910433498
[[44081  1328]
 [ 4848 10183]]
------TEST------
ACCURACY: 0.7028457974851092
NEGATIVE RECALL (Y=0): 0.8415368271954674
NEGATIVE PRECISION (Y=0): 0.778797312796985
POSITIVE RECALL (Y=1): 0.29208180388044047
POSITIVE PRECISION (Y=1): 0.38360881542699726
[[9506 1790]
 [2700 1114]]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-9-output-2.png" width="647" height="509"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-9-output-3.png" width="639" height="509"></p>
</div>
</div>
</section>
<section id="now-lets-visualize-the-decision-tree.-however-since-the-number-of-layers-is-somewhat-big-and-the-number-of-features-is-large-the-visualization-might-not-be-informative." class="level3">
<h3 class="anchored" data-anchor-id="now-lets-visualize-the-decision-tree.-however-since-the-number-of-layers-is-somewhat-big-and-the-number-of-features-is-large-the-visualization-might-not-be-informative.">Now let’s visualize the decision tree. However, since the number of layers is somewhat big and the number of features is large, the visualization might not be informative.</h3>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_tree(model,X,Y):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    fitted <span class="op">=</span> model.fit(X,Y)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> tree.plot_tree(fitted,    </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                   class_names<span class="op">=</span>[<span class="st">'0'</span>,<span class="st">'1'</span>],</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plot_tree(model,x_train,y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-10-output-1.png" width="549" height="389"></p>
</div>
</div>
</section>
</section>
<section id="in-summary" class="level2">
<h2 class="anchored" data-anchor-id="in-summary">In summary:</h2>
<p>Even with a thoughtfully selected number of layers, the decision tree model remains ineffective in capturing instances of the positive class. Hence, we might choose a more complex model such as random forest.</p>
</section>
<section id="use-random-forest-classifier" class="level2">
<h2 class="anchored" data-anchor-id="use-random-forest-classifier">Use Random Forest Classifier</h2>
<section id="we-will-employ-the-identical-training-and-testing-sets-as-utilized-in-the-preceding-decision-tree-section-for-training-the-random-forest-classifier." class="level3">
<h3 class="anchored" data-anchor-id="we-will-employ-the-identical-training-and-testing-sets-as-utilized-in-the-preceding-decision-tree-section-for-training-the-random-forest-classifier.">We will employ the identical training and testing sets as utilized in the preceding decision tree section for training the random forest classifier.</h3>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>rfc <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rfc.fit(x_train, y_train)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rfc.predict(x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-accuracy-score-for-the-model" class="level3">
<h3 class="anchored" data-anchor-id="check-accuracy-score-for-the-model">Check accuracy score for the model</h3>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Model accuracy score with 10 decision-trees (default): </span><span class="sc">{0:0.4f}</span><span class="st">'</span>. <span class="bu">format</span>(accuracy_score(y_test, y_pred)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model accuracy score with 10 decision-trees (default): 0.7621</code></pre>
</div>
</div>
</section>
<section id="now-lets-pick-a-random-forest-classifier-with-parameter-n_estimators-equal-to-50-and-compute-the-feature-scores" class="level3">
<h3 class="anchored" data-anchor-id="now-lets-pick-a-random-forest-classifier-with-parameter-n_estimators-equal-to-50-and-compute-the-feature-scores">Now let’s pick a random forest classifier with parameter ‘n_estimators’ equal to 50 and compute the feature scores</h3>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rfc_50 <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">50</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>rfc_50.fit(x_train, y_train)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>y_pred_50 <span class="op">=</span> rfc_50.predict(x_test)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Model accuracy score with 100 decision-trees : </span><span class="sc">{0:0.4f}</span><span class="st">'</span>. <span class="bu">format</span>(accuracy_score(y_test, y_pred_50)))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>feature_scores <span class="op">=</span> pd.Series(rfc_50.feature_importances_, index<span class="op">=</span>x_train.columns).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model accuracy score with 100 decision-trees : 0.7611</code></pre>
</div>
</div>
</section>
</section>
<section id="lets-visualize-the-feature-scores" class="level2">
<h2 class="anchored" data-anchor-id="lets-visualize-the-feature-scores">Let’s visualize the feature scores</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>feature_scores, y<span class="op">=</span>feature_scores.index)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Feature Score'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Features'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Visualizing Influential Features"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="decisiontree_files/figure-html/cell-14-output-1.png" width="744" height="455"></p>
</div>
</div>
</section>
<section id="in-summary-1" class="level2">
<h2 class="anchored" data-anchor-id="in-summary-1">In summary:</h2>
<p>From the above feature score results, ‘Hour_of_Day’ is the most influential feature.</p>
<section id="finally-lets-look-at-the-confusion-matrix-and-the-classification-report" class="level3">
<h3 class="anchored" data-anchor-id="finally-lets-look-at-the-confusion-matrix-and-the-classification-report">Finally, let’s look at the confusion matrix and the classification report</h3>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Confusion matrix</span><span class="ch">\n\n</span><span class="st">'</span>, cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion matrix

 [[  557  3257]
 [  338 10958]]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               precision    recall  f1-score   support

Fatal_Serious       0.62      0.15      0.24      3814
       Slight       0.77      0.97      0.86     11296

     accuracy                           0.76     15110
    macro avg       0.70      0.56      0.55     15110
 weighted avg       0.73      0.76      0.70     15110
</code></pre>
</div>
</div>
</section>
</section>
<section id="in-conclusion" class="level2">
<h2 class="anchored" data-anchor-id="in-conclusion">In conclusion:</h2>
<p>Based on the classification reports for both models, the random forest works much better than the decision tree in terms of high predicting accuracy for both positive and negative cases.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>